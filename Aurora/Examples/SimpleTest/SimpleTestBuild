#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset
# set -o xtrace

# 2016-11-21 
# Build script for SimpleTest Xcode project


BuildXcodeProjectForTarget()
{
	printf "${FUNCNAME[0]}\n"
	
	local projectName=$1
	local targetName=$2
	local config=$3
	local buildDir=$4
	xcodebuild \
		-project ${projectName} \
		-target ${targetName} \
			-configuration ${config} \
			CONFIGURATION_BUILD_DIR=${buildDir} \
			clean build | xcpretty
	# if you want to use egrep instead of xcpretty
	#| egrep -A 5 "(error|warning):"
	
}

SetupPathVariables()
{
	CURRENTPATH=${PWD}
	cd ${ABSOLUTE_PATH}
	BUILDPATH=${PWD}/xcbuild
	cd ../..
	BASEPATH=${PWD}
}

main()
{
	SetupPathVariables
	
	cd ${BASEPATH}/External/libRocket/Build
	BuildXcodeProjectForTarget Rocket.xcodeproj RocketControlsOSX Release "${PWD}/build/Release"
	BuildXcodeProjectForTarget Rocket.xcodeproj RocketDebuggerOSX Release "${PWD}/build/Release"
		
	cd ${ABSOLUTE_PATH}
	BuildXcodeProjectForTarget SimpleTest.xcodeproj SimpleTest Debug "${BUILDPATH}/Debug"
}

ABSOLUTE_SCRIPT_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/$(basename "${BASH_SOURCE[0]}")"
ABSOLUTE_PATH=`dirname ${ABSOLUTE_SCRIPT_PATH}`

main
